import{aw as ee,a as te,a8 as ae,r as s,v as F,y as oe,A as le,z as re,c as A,o as u,w as l,e as a,f as _,aa as L,ax as se,F as ne,i as ie,az as h,a4 as E,aA as T,k as r,t as w,aB as ue,j as m,ab as C,d as I,ay as de,aE as j,aD as z,h as N,aC as ce,a3 as ve}from"./index-DA9jGqo6.js";import{f as H}from"./favorite-B60dHq9s.js";import{b as O}from"./route-block-B_A1xBdJ.js";import{V as R,a as D}from"./VRow-D6Xm8EpC.js";import{V as q}from"./VSelect-DvsPie5H.js";import{V as fe}from"./VContainer-C3jUjEf3.js";import"./VList-Bf68H6Nb.js";import"./VListItem-CUkEbiw7.js";import"./ssrBoot-C9nU99c7.js";import"./VDivider-UkByiMj5.js";const me={key:0,class:"hover-actions"},pe={key:1,class:"empty-state"},ge={class:"text-center"},ye={key:2,class:"text-center my-4"},xe=12,G={__name:"favorite",setup(Ve){const S=te(),k=ae(),n=s([]),f=s(""),i=s("全部"),p=s("最新收藏"),b=s(1),g=s(!1),J=["最新收藏","最舊收藏"],B=s(["全部"]),U=F(()=>{let o=n.value;if(f.value){const e=f.value.toLowerCase();o=o.filter(t=>[t._id,t.title,t.description,t.location].some(v=>String(v||"").toLowerCase().includes(e)))}return i.value&&i.value!=="全部"&&(o=o.filter(e=>(Array.isArray(e.category)?e.category:[e.category]).includes(i.value))),p.value==="最新收藏"?o=o.sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)):o=o.sort((e,t)=>new Date(e.createdAt)-new Date(t.createdAt)),o}),y=s([]),x=()=>{const e=b.value*xe;y.value=U.value.slice(0,e)},K=F(()=>y.value.length<U.value.length);function Q(){g.value||!K.value||(g.value=!0,b.value++,ve(()=>{x(),g.value=!1}))}const V=s(null);function P(){if(!V.value)return;const o=V.value.$el||V.value;o.scrollHeight-o.scrollTop-o.clientHeight<100&&Q()}async function $(){try{const{data:o}=await H.getAll();n.value=o.favorites.map(t=>({...t.post,favoriteId:t._id,hover:!1})),S.setFavorites(n.value.length);const e=n.value.flatMap(t=>Array.isArray(t.category)?t.category:[t.category]).filter(Boolean);B.value=["全部",...new Set(e)],x()}catch{k({text:"無法載入收藏資料",snackbarProps:{color:"red"}})}}async function W(o){try{const e=n.value.find(t=>t._id===o);if(!e)return;await H.remove(e.favoriteId),n.value=n.value.filter(t=>t._id!==o),x(),S.setFavorites(n.value.length),k({text:"已取消收藏",snackbarProps:{color:"blue"}})}catch(e){console.error(e),k({text:"取消收藏失敗",snackbarProps:{color:"red"}})}}const M=()=>$();oe(()=>{$(),window.addEventListener("favoritesUpdated",M),window.addEventListener("scroll",P)}),le(()=>{window.removeEventListener("favoritesUpdated",M),window.removeEventListener("scroll",P)});const d=s({open:!1,src:""});function X(o){d.value.src=o,d.value.open=!0}const c=s({open:!1,text:""});function Y(o){c.value.text=o||"(沒有文章)",c.value.open=!0}function Z(o){return o?Array.isArray(o)?o.join("、"):o:""}return re([f,i,p],()=>{b.value=1,x()}),(o,e)=>(u(),A(fe,null,{default:l(()=>[a(R,{class:"mb-4",align:"center",justify:"space-between"},{default:l(()=>[a(D,{cols:"12",md:"6",class:"search-container"},{default:l(()=>[a(se,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),label:"搜尋收藏","prepend-inner-icon":"mdi-magnify",variant:"solo",density:"comfortable",flat:"","hide-details":""},null,8,["modelValue"])]),_:1}),a(D,{class:"d-flex justify-end align-center",cols:"12",md:"6"},{default:l(()=>[a(q,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value=t),items:B.value,variant:"outlined",density:"comfortable","menu-props":{maxHeight:"300"},"onClick:clear":e[2]||(e[2]=t=>i.value="全部"),"hide-details":"",style:{"background-color":"white",height:"49px",opacity:"0.7","box-shadow":"0 2px 5px rgba(0, 0, 0, 0.2)"}},null,8,["modelValue","items"]),a(q,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=t=>p.value=t),items:J,variant:"outlined",density:"comfortable","hide-details":"",style:{"background-color":"white",height:"49px",opacity:"0.7","box-shadow":"0 2px 5px rgba(0, 0, 0, 0.2)"}},null,8,["modelValue"])]),_:1})]),_:1}),y.value.length>0?(u(),A(R,{key:0,ref_key:"listContainer",ref:V},{default:l(()=>[(u(!0),_(ne,null,ie(y.value,t=>(u(),A(D,{key:t._id,cols:"12",sm:"6",md:"4",lg:"3",class:"fade-in"},{default:l(()=>[a(h,{elevation:"2",class:"d-flex flex-column card-hover",onMouseenter:v=>t.hover=!0,onMouseleave:v=>t.hover=!1},{default:l(()=>[a(E,{src:t.image,height:"180",class:"cursor-pointer img-scale",onClick:v=>X(t.image)},null,8,["src","onClick"]),a(T,{class:"text-truncate text-center"},{default:l(()=>[r(w(t.title),1)]),_:2},1024),a(ue,{class:"text-truncate"},{default:l(()=>[r(w(Z(t.category))+" - "+w(t.location),1)]),_:2},1024),t.hover?(u(),_("div",me,[a(m,{small:"",color:"primary",onClick:v=>Y(t.description)},{default:l(()=>[a(C,{left:""},{default:l(()=>e[8]||(e[8]=[r("mdi-eye",-1)])),_:1,__:[8]}),e[9]||(e[9]=r("查看文章 ",-1))]),_:2,__:[9]},1032,["onClick"]),a(m,{small:"",color:"red",onClick:v=>W(t._id)},{default:l(()=>[a(C,{left:""},{default:l(()=>e[10]||(e[10]=[r("mdi-heart-off",-1)])),_:1,__:[10]}),e[11]||(e[11]=r("取消收藏 ",-1))]),_:2,__:[11]},1032,["onClick"])])):L("",!0)]),_:2},1032,["onMouseenter","onMouseleave"])]),_:2},1024))),128))]),_:1},512)):(u(),_("div",pe,[I("div",ge,[a(C,{size:"64",color:"grey"},{default:l(()=>e[12]||(e[12]=[r("mdi-heart-outline",-1)])),_:1,__:[12]}),e[15]||(e[15]=I("p",{class:"text-h6 text-grey mb-4"},"目前還沒有收藏",-1)),a(m,{color:"primary",rounded:"",to:"/"},{default:l(()=>[a(C,{left:""},{default:l(()=>e[13]||(e[13]=[r("mdi-compass-outline",-1)])),_:1,__:[13]}),e[14]||(e[14]=r(" 去看看 ",-1))]),_:1,__:[14]})])])),g.value?(u(),_("div",ye,[a(de,{indeterminate:"",color:"primary"})])):L("",!0),a(j,{modelValue:d.value.open,"onUpdate:modelValue":e[5]||(e[5]=t=>d.value.open=t),"max-width":"800px"},{default:l(()=>[a(h,null,{default:l(()=>[a(E,{src:d.value.src,class:"w-100",cover:""},null,8,["src"]),a(z,null,{default:l(()=>[a(N),a(m,{text:"",color:"primary",onClick:e[4]||(e[4]=t=>d.value.open=!1)},{default:l(()=>e[16]||(e[16]=[r("關閉",-1)])),_:1,__:[16]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(j,{modelValue:c.value.open,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value.open=t),"max-width":"500px"},{default:l(()=>[a(h,null,{default:l(()=>[a(T,null,{default:l(()=>e[17]||(e[17]=[r("文章內容",-1)])),_:1,__:[17]}),a(ce,null,{default:l(()=>[r(w(c.value.text),1)]),_:1}),a(z,null,{default:l(()=>[a(N),a(m,{text:"",color:"primary",onClick:e[6]||(e[6]=t=>c.value.open=!1)},{default:l(()=>e[18]||(e[18]=[r("關閉",-1)])),_:1,__:[18]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};typeof O=="function"&&O(G);const Ue=ee(G,[["__scopeId","data-v-ef46e82c"]]);export{Ue as default};
