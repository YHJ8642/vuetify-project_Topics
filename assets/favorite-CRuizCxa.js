import{aw as ae,a as le,a8 as oe,r as n,v as F,y as re,A as se,z as ne,c as k,o as u,w as l,e as a,f as y,aa as L,ay as ie,F as M,i as z,aA as A,a4 as E,aB as T,k as r,t as v,aC as ue,j as m,ab as p,d as N,az as de,aF as j,aE as H,h as O,aD as q,a3 as ce}from"./index-BxHN7eqe.js";import{f as R}from"./favorite-DaKV0mva.js";import{b as G}from"./route-block-B_A1xBdJ.js";import{V as J,a as D}from"./VRow-BHuSmqag.js";import{V as K,a as ve}from"./VSelect-BIplBZpI.js";import{V as fe}from"./VContainer-CUJLwBHn.js";import"./VList-CiRUSjkD.js";import"./VListItem-Jep9xHel.js";import"./ssrBoot-DDSpbYyQ.js";import"./VDivider-Dpyx-vhS.js";const me={key:0,class:"hover-actions"},pe={key:1,class:"empty-state"},ge={class:"text-center"},ye={key:2,class:"text-center my-4"},_e=12,Q={__name:"favorite",setup(xe){const S=le(),b=oe(),d=n([]),g=n(""),c=n("全部"),_=n("最新收藏"),h=n(1),x=n(!1),W=["最新收藏","最舊收藏"],B=n(["全部"]),U=F(()=>{let o=d.value;if(g.value){const e=g.value.toLowerCase();o=o.filter(t=>[t._id,t.title,t.description,t.location].some(i=>String(i||"").toLowerCase().includes(e)))}return c.value&&c.value!=="全部"&&(o=o.filter(e=>(Array.isArray(e.category)?e.category:[e.category]).includes(c.value))),_.value==="最新收藏"?o=o.sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)):o=o.sort((e,t)=>new Date(e.createdAt)-new Date(t.createdAt)),o}),V=n([]),w=()=>{const e=h.value*_e;V.value=U.value.slice(0,e)},X=F(()=>V.value.length<U.value.length);function Y(){x.value||!X.value||(x.value=!0,h.value++,ce(()=>{w(),x.value=!1}))}const C=n(null);function I(){if(!C.value)return;const o=C.value.$el||C.value;o.scrollHeight-o.scrollTop-o.clientHeight<100&&Y()}async function P(){try{const{data:o}=await R.getAll();d.value=o.favorites.map(t=>({...t.post,favoriteId:t._id,hover:!1})),S.setFavorites(d.value.length);const e=d.value.flatMap(t=>Array.isArray(t.category)?t.category:[t.category]).filter(Boolean);B.value=["全部",...new Set(e)],w()}catch{b({text:"無法載入收藏資料",snackbarProps:{color:"red"}})}}async function Z(o){try{const e=d.value.find(t=>t._id===o);if(!e)return;await R.remove(e.favoriteId),d.value=d.value.filter(t=>t._id!==o),w(),S.setFavorites(d.value.length),b({text:"已取消收藏",snackbarProps:{color:"blue"}})}catch(e){console.error(e),b({text:"取消收藏失敗",snackbarProps:{color:"red"}})}}const $=()=>P();re(()=>{P(),window.addEventListener("favoritesUpdated",$),window.addEventListener("scroll",I)}),se(()=>{window.removeEventListener("favoritesUpdated",$),window.removeEventListener("scroll",I)});const f=n({open:!1,src:""});function ee(o){f.value.src=o,f.value.open=!0}const s=n({open:!1,text:"",postId:null,title:""});function te(o){s.value.text=o.description||"(沒有文章)",s.value.open=!0,s.value.postId=o._id||null,s.value.title=o.title||"文章內容",s.value.location=o.location||""}return ne([g,c,_],()=>{h.value=1,w()}),(o,e)=>(u(),k(fe,null,{default:l(()=>[a(J,{class:"mb-4",align:"center",justify:"space-between"},{default:l(()=>[a(D,{cols:"12",md:"6",class:"search-container"},{default:l(()=>[a(ie,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),label:"搜尋收藏","prepend-inner-icon":"mdi-magnify",variant:"solo",density:"comfortable",flat:"","hide-details":""},null,8,["modelValue"])]),_:1}),a(D,{class:"d-flex justify-end align-center",cols:"12",md:"6"},{default:l(()=>[a(K,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),items:B.value,variant:"outlined",density:"comfortable","menu-props":{maxHeight:"300"},"onClick:clear":e[2]||(e[2]=t=>c.value="全部"),"hide-details":"",style:{"background-color":"white",height:"49px",opacity:"0.7","box-shadow":"0 2px 5px rgba(0, 0, 0, 0.2)"}},null,8,["modelValue","items"]),a(K,{modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=t=>_.value=t),items:W,variant:"outlined",density:"comfortable","hide-details":"",style:{"background-color":"white",height:"49px",opacity:"0.7","box-shadow":"0 2px 5px rgba(0, 0, 0, 0.2)"}},null,8,["modelValue"])]),_:1})]),_:1}),V.value.length>0?(u(),k(J,{key:0,ref_key:"listContainer",ref:C},{default:l(()=>[(u(!0),y(M,null,z(V.value,t=>(u(),k(D,{key:t._id,cols:"12",sm:"6",md:"4",lg:"3",class:"fade-in"},{default:l(()=>[a(A,{elevation:"2",class:"d-flex flex-column card-hover",onMouseenter:i=>t.hover=!0,onMouseleave:i=>t.hover=!1},{default:l(()=>[a(E,{src:t.image,height:"180",class:"cursor-pointer img-scale",onClick:i=>ee(t.image)},null,8,["src","onClick"]),a(T,{class:"text-truncate text-center"},{default:l(()=>[r(v(t.title),1)]),_:2},1024),a(ue,{class:"text-truncate"},{default:l(()=>[(u(!0),y(M,null,z(t.category,i=>(u(),k(ve,{key:i,size:"small",color:"primary",class:"ml-1"},{default:l(()=>[r(v(i),1)]),_:2},1024))),128)),r(" - 🕒 "+v(new Date(t.createdAt).toLocaleString()),1)]),_:2},1024),t.hover?(u(),y("div",me,[a(m,{small:"",color:"primary",onClick:i=>te(t)},{default:l(()=>[a(p,{left:""},{default:l(()=>e[8]||(e[8]=[r("mdi-eye",-1)])),_:1,__:[8]}),e[9]||(e[9]=r("查看文章 ",-1))]),_:2,__:[9]},1032,["onClick"]),a(m,{small:"",color:"red",onClick:i=>Z(t._id)},{default:l(()=>[a(p,{left:""},{default:l(()=>e[10]||(e[10]=[r("mdi-heart-off",-1)])),_:1,__:[10]}),e[11]||(e[11]=r("取消收藏 ",-1))]),_:2,__:[11]},1032,["onClick"])])):L("",!0)]),_:2},1032,["onMouseenter","onMouseleave"])]),_:2},1024))),128))]),_:1},512)):(u(),y("div",pe,[N("div",ge,[a(p,{size:"64",color:"grey"},{default:l(()=>e[12]||(e[12]=[r("mdi-heart-outline",-1)])),_:1,__:[12]}),e[15]||(e[15]=N("p",{class:"text-h6 text-grey mb-4"},"目前還沒有收藏",-1)),a(m,{color:"primary",rounded:"",to:"/"},{default:l(()=>[a(p,{left:""},{default:l(()=>e[13]||(e[13]=[r("mdi-compass-outline",-1)])),_:1,__:[13]}),e[14]||(e[14]=r(" 去看看 ",-1))]),_:1,__:[14]})])])),x.value?(u(),y("div",ye,[a(de,{indeterminate:"",color:"primary"})])):L("",!0),a(j,{modelValue:f.value.open,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value.open=t),"max-width":"800px"},{default:l(()=>[a(A,null,{default:l(()=>[a(E,{src:f.value.src,class:"w-100",cover:""},null,8,["src"]),a(H,null,{default:l(()=>[a(O),a(m,{text:"",color:"primary",onClick:e[4]||(e[4]=t=>f.value.open=!1)},{default:l(()=>e[16]||(e[16]=[r("關閉",-1)])),_:1,__:[16]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(j,{modelValue:s.value.open,"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.open=t),"max-width":"600px"},{default:l(()=>[a(A,null,{default:l(()=>[a(T,{class:"dialog-title"},{default:l(()=>[r(v(s.value.title||"文章內容"),1)]),_:1}),a(q,null,{default:l(()=>[a(p,{start:"",size:"small",color:"grey"},{default:l(()=>e[17]||(e[17]=[r("mdi-source-branch",-1)])),_:1,__:[17]}),r(v(s.value.location),1)]),_:1}),a(q,null,{default:l(()=>[r(v(s.value.text),1)]),_:1}),a(H,null,{default:l(()=>[a(O),a(m,{color:"teal",text:"",to:{path:"/",query:{id:s.value.postId,showComments:!0}}},{default:l(()=>[a(p,{start:""},{default:l(()=>e[18]||(e[18]=[r("mdi-comment-outline",-1)])),_:1,__:[18]}),r(" 查看留言 "+v(s.value.postId?"":"(沒有文章)"),1)]),_:1},8,["to"]),a(m,{text:"",color:"primary",onClick:e[6]||(e[6]=t=>s.value.open=!1)},{default:l(()=>e[19]||(e[19]=[r("關閉",-1)])),_:1,__:[19]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};typeof G=="function"&&G(Q);const Ue=ae(Q,[["__scopeId","data-v-87c34c8a"]]);export{Ue as default};
